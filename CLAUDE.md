# Kyosan-Mapについて

## 要求・要件定義書

```md

# 設計

# 神山祭探索Webアプリ 要求定義・要件定義

## 1. プロジェクト概要

### 1.1 プロジェクト名

未定

### 1.2 開催概要

- **開催時期**: 11月（2日間開催）
- **開催場所**: 京都産業大学キャンパス内
- **対象イベント**: 神山祭（学園祭）

### 1.3 プロジェクト目的

神山祭の来場者に対して、学生作品の効果的な紹介、キャンパス内での快適なナビゲーション、および京都産業大学特有の地理的課題を解決する統合的なWebアプリケーションを提供する。

### 1.4 背景・解決すべき課題

- **地理的課題**: 京都産業大学の高低差が激しく複雑な地形、既存地図の視認性の悪さ
- **情報不足**: 建物間の移動ルートや隠れた近道の情報不足
- **作品展示の限界**: 物理的な展示スペースに依存しない学生作品の紹介手法の必要性
- **来場者体験**: より楽しく効率的なキャンパス散策の実現

### 1.5 成功指標

- **主要指標**: コレクション収集率
- **副次指標**: 部活内ハッカソンでのGoogleアンケート順位
- **定性指標**: 来場者の満足度および京都産業大学の魅力発信効果

## 2. ターゲット分析

### 2.1 主要ターゲット

- **受験生・高校生**: 大学の魅力を知る機会
- **保護者・家族**: 子どもの進路選択支援
- **地域の一般来場者**: 京都産業大学への理解促進
- **他大学の学生**: 学園祭交流および大学間比較

### 2.2 利用シーン

- **滞在時間**: 平均3時間（理想的な体験は5時間でコレクション完全収集）
- **利用環境**: 屋外・屋内半々での利用
- **デバイス**: 主にスマートフォン
- **リピート利用**: 2日目来場者への地図機能中心の提供

## 3. 機能要件

### 3.1 コレクション機能

### 3.1.1 基本仕様

- **作品カテゴリ**: CG、音楽、絵画の3種類
- **収集可能数**: 各カテゴリ7-20作品（総計21-60作品）
- **収集方法**:
    - 主要: 教室の部屋番号をカメラでスキャン
    - 代替: 検索窓での部屋番号入力（スキャン困難な場合）

### 3.1.2 作品表示機能

**CGコレクション**

- ゲーム風インターフェースでの高解像度表示
- 作品詳細情報（作者、制作コンセプトなど）

**音楽コレクション**

- スキャン時の自動再生開始
- 音楽プレイヤーインターフェース
- 楽曲情報表示

**絵画コレクション**

- ギャラリー形式での表示
- 高画質画像ビューアー

### 3.1.3 管理・表示機能

- コレクション一覧ページ
- 進捗表示（収集率の%表示）
- カテゴリ別フィルタリング
- 収集済み/未収集の状態管理

### 3.2 地図・ナビゲーション機能

### 3.2.1 基本地図機能

- **ベース地図**: Google Maps API使用
- **独自データ**:
    - 学食・食堂の詳細情報
    - 建物番号の正確な表示
    - 建物間移動のヒント情報

### 3.2.2 高低差対応機能

- 建物内の近道情報
- エスカレーター位置の表示
- フロア間移動制限の情報表示
- 階段・坂道の難易度表示

### 3.2.3 位置連動機能

- **現在地更新**: ボタン式でのGPS位置取得
- **近場案内**:
    - 昼時の半径n メートル内学食通知
    - 周辺建物一覧表示
    - フィルタリング機能

### 3.2.4 オフライン対応

- PWA実装による地図データの事前読み込み
- 通信環境に依存しない基本機能の提供

### 3.3 カメラ・AR機能

### 3.3.1 基本スキャン機能

- 部屋番号の文字認識
- 認識精度向上のためのユーザー投稿データ活用
- 現在地更新機能との連携

### 3.3.2 拡張機能（プラスアルファ）

- **Live2D機能**: インカメでのアバター表示
- **カスタマイズ**: コレクション内容のアバター装備
- **撮影機能**: カスタマイズしたアバターのスクリーンショット

## 4. 非機能要件

### 4.1 パフォーマンス要件

- **アプリ起動時間**: 3秒以内
- **地図表示**: 2秒以内
- **オフライン機能**: PWAによる高速読み込み

### 4.2 ユーザビリティ要件

- 神山祭来場者（外部の方）にとって直感的な操作性
- 簡潔なチュートリアル機能
- 代替手段の提供（カメラ→検索、GPS→手動更新）

### 4.3 信頼性要件

- **ホスティング**: CloudflareまたはVercel使用による高可用性
- **エラーハンドリング**: 機能単位での代替手段確保
- **データ整合性**: 作品データの確実な表示

### 4.4 技術要件

- **フロントエンド**: PWA対応Webアプリケーション
- **地図API**: Google Maps API
- **機械学習**: 部屋番号認識精度向上
- **データ管理**: 静的データによる高速配信

## 5. 開発・運用計画

### 5.1 開発体制

- **エンジニア**: 5名
- **コンテンツ制作**: 5名程度（CG・音楽・絵画担当）
- **開発支援**: Claude Code、AI開発ツール活用

### 5.2 スケジュール

- **開発期間**: 8月初旬〜10月末（約3ヶ月）
- **コンテンツ完成**: 10月末
- **テスト期間**: 1週間（神山祭直前）
- **本番運用**: 11月神山祭期間中（2日間）

### 5.3 品質保証

- **実地テスト**: キャンパス内での動作確認
- **ユーザビリティテスト**: 部活メンバー以外での操作確認
- **パフォーマンステスト**: 想定アクセス数での負荷確認

## 6. 運用要件

### 6.1 神山祭当日の運用

- **利用説明**: 展示教室での直接説明 + アプリ内チュートリアル
- **トラブル対応**: 代替機能の充実による自己解決促進
- **技術サポート**: 開発チームメンバーによる現地サポート

### 6.2 フィードバック収集

- **方法**: 部活内ハッカソン提供のGoogleアンケート
- **対象**: 神山祭来場者
- **用途**: プロジェクト評価および今後の改善点抽出

### 6.3 コンテンツ管理

- **更新頻度**: 神山祭前の一括更新のみ
- **データ形式**: 静的データによる高速配信
- **管理者機能**: 当初は不要（将来的な拡張可能性は残す）

## 7. リスク管理

### 7.1 技術リスク

- **GPS精度問題**: 手動更新機能による代替
- **カメラ認識精度**: 検索窓入力による代替
- **通信環境**: PWAオフライン機能による対応

### 7.2 運用リスク

- **大量アクセス**: CDN使用による負荷分散
- **ユーザビリティ**: 事前テストと代替手段の充実
- **コンテンツ不足**: 各カテゴリ最低7作品の確保

### 7.3 プロジェクトリスク

- **開発遅延**: 段階的リリースによる最小機能の確保
- **チーム連携**: 定期的な進捗共有とAI開発ツール活用

## 8. 将来展望

### 8.1 短期的拡張可能性

- Live2D機能の本格実装
- より高度なAR機能
- ソーシャル機能（友人との進捗比較など）

### 8.2 長期的展望

- 他の大学イベントへの横展開
- 通年利用可能な京都産業大学案内アプリへの発展
- 学生作品の常設展示プラットフォーム化

## 9.課題

### 9.1 Google Map Platformの費用的問題

- 一ヶ月10000回の呼び出しまでは無料。それ以降は有料で10000回ごとに約2万円
- そのため地図機能のみはログイン後にしか使えないようにする
- および、Cloudflareを使いスクレイピングやボットによる攻撃対策を行う

### 9.2 動作環境

- あまりにアクセスが多すぎると動かない
- CDNを利用して分散しても、アクセス場所が同じなので意味があまりないかもしれない
- より高度な機能を使いたい場合はGCPやAWSなどを使った方がいいかもしれない

## 10. 付録

### 10.1 想定技術スタック

- **フロントエンド**: React, NextJS, PWA
- **地図**: Google Map Platform
- **ホスティング**: Cloudflare/Vercel
- **画像認識**: 機械学習ライブラリ（詳細は開発時決定）/　おそらくYolo11?
- **開発支援**: Claude Code, Cursor, ChatGPT, Cline

### 10.2 参考指標

- **目標収集率**: 60%以上
- **平均滞在時間**: 3時間
- **アプリ利用率**: 神山祭来場者の5%以上

```

## プロジェクト概要

これは「kyosan-map」というshadcn/uiベースのプロジェクト用のTurborepoモノレポです。パッケージマネージャーにPNPMを使用し、以下を含んでいます：

- `apps/web`: App Routerを使用したNext.jsアプリケーション（React 19、Next.js 15.4+）
- `apps/dev`: App Routerを使用したlive2d,out-camera,collections,mapをそれぞれのpathで単純なデモを見ることができる（React 19、Next.js 15.4+）
- `packages/ui`: shadcn/uiコンポーネントを含む共有UIコンポーネントライブラリ
- `packages/eslint-config`: 共有ESLint設定
- `packages/typescript-config`: 共有TypeScript設定
- `packages/out-camera`: 外側のカメラのコード
- `packages/live2d`: Live2dの実装のためのコード
- `packages/collections`: コレクションおよび、そのヘルパーコンポーネントや画像を配置する
- `packages/map` 地図および地図データ。およびそのヘルパー的コンポーネントなどの配置

## 開発コマンド

リポジトリのルートからコマンドを実行：

- `pnpm dev` - すべてのパッケージの開発サーバーを起動
- `pnpm build` - すべてのパッケージをビルド
- `pnpm lint` - すべてのパッケージでリンティングを実行
- `pnpm format` - Prettierでコードをフォーマット

### Webアプリ固有のコマンド

`apps/web`に移動して実行：

- `pnpm dev` - TurbopackでNext.js開発サーバーを起動
- `pnpm build` - Next.jsアプリをビルド
- `pnpm start` - 本番サーバーを起動
- `pnpm lint` - Next.js ESLintを実行
- `pnpm lint:fix` - ESLintの問題を自動修正
- `pnpm typecheck` - TypeScript型チェックを実行

## アーキテクチャ

### モノレポ構造

- ビルドオーケストレーションとキャッシュにTurboを使用
- パッケージ管理にPNPMワークスペースを使用
- 一貫したツール設定のための共有設定パッケージ

### UIパッケージ（`packages/ui`）

- Radix UIプリミティブを使用したshadcn/uiコンポーネントで構築
- スタイリングにTailwind CSS v4を使用
- package.jsonのexports mapを通じてコンポーネントをエクスポート
- バリアント処理にclass-variance-authorityを使用してスタイル設定
- `src/lib/utils.ts`にユーティリティを含む

### 外側のカメラ(`packages/out-camera`)

- カメラにより、部屋番号や何号館かの識別を行うためのパッケージ
- これは副作用付きのコンポーネントとして独立して動くように実装する

### Live2d(`packages/live2d`)

- Live2dの実装
- まだどうするかは未定

### コレクション(`packages/collections`)

- コレクション機能のためのCG,画像,音楽などの配置
- それと共にそのためのコンポーネントの提供
- Live2d上で表示できるようにもする

### 地図(`packages/map`)

- 地図データおよび、地図表示のためのコンポーネント
- 一定範囲内の表示などができる

### Webアプリ（`apps/web`）

- App RouterとReact 19を使用したNext.js 15
- `@kyosan-map/ui`パッケージからUIコンポーネントをインポート
- Geistフォント（SansとMono）を使用
- `next-themes`でダーク/ライトテーマ切り替えに対応

## デモアプリ(`apps/dev`)

- それぞれのpathごとに、`live2d`, `out-camera`, `collections`, `map`のデモを提供
- お互いに影響が及ばないようにする
- より簡単にデモを確認できるようにする

## shadcn/uiコンポーネントの追加

新しいshadcn/uiコンポーネントを追加するには、リポジトリのルートから実行：

```bash
pnpm dlx shadcn@latest add [コンポーネント名] -c apps/web
```

これにより、コンポーネントが`packages/ui/src/components/`に配置され、すべてのアプリで利用可能になります。

## インポートパターン

UIコンポーネントは以下のようにインポート：

```tsx
import { Button } from "@kyosan-map/ui/components/button"
import { cn } from "@kyosan-map/ui/lib/utils"
```

## 要件

- Node.js >=20
- PNPM 10.4.1+（packageManagerで指定）
- TypeScript 5.7.3
